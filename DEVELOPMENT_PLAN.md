# 开发计划

本计划用于指导 `collect_refunding_data.py` 项目的后续开发工作。所有代码改动应按照以下步骤依次完成，完成后在对应条目中标记 ✅ 并记录完成情况。

## 总体目标
- 提升抓取脚本的可靠性和可测试性。
- 为关键解析逻辑补充可重复执行的测试。
- 改善错误处理与可观察性，确保生成的 `refunding_data.csv` 数据稳定。

## 分步任务
1. ✅ **基础筹备**（当前步骤）
   - 建立开发计划与测试计划文档，明确需求、任务与测试覆盖范围。
   - 输出：`DEVELOPMENT_PLAN.md`、`TEST_PLAN.md`。
   - 完成日期：2024-04-05。
2. ⬜ **构建离线测试夹具与工具**
   - 采集至少 2 个季度的官方讲话 HTML 与推荐表格 PDF 样本（脱敏后存入仓库的 `tests/fixtures/`）。
   - 编写用于加载夹具的辅助函数，避免对真实站点的依赖。
   - 输出：夹具文件、`tests/conftest.py` 中的加载工具。
3. ⬜ **编写核心解析函数的单元测试**
   - 针对 `parse_maturity`、`categorize_security` 编写参数化测试覆盖常见与边界输入。
   - 针对 `_parse_matrix_recommended_pages` 与 `parse_recommended_pdf` 使用夹具验证解析结果。
   - 输出：`tests/test_parsers.py` 及相应的断言。
4. ⬜ **实现 `collect_data` 的集成测试**
   - 使用 `requests_mock` 或 monkeypatch 技术模拟 HTTP 响应，验证多季度聚合行为。
   - 确保 CSV 写出顺序与字段一致性。
   - 输出：`tests/test_collect_data.py`。
5. ⬜ **增强脚本的健壮性**
   - 为网络请求添加超时与重试机制，记录解析失败的上下文信息。
   - 提供可选的命令行参数（如 `--max-quarters`、`--output`）。
   - 更新 README，描述运行方法与测试说明。
   - 输出：更新的 `collect_refunding_data.py`、`README.md`、相关文档。
6. ⬜ **回归与文档完善**
   - 运行完整测试套件并记录测试结果（参见 `TEST_PLAN.md`）。
   - 汇总开发中发现的问题与改进建议，更新本计划的进度标记。
   - 输出：测试报告、计划文件的最终状态更新。

## 进度记录
- 2024-04-05：完成基础筹备，新增开发与测试计划文档，建立后续工作框架。

> 注意：后续步骤完成后，请在“分步任务”中将对应条目标记为 ✅，并在“进度记录”中追加说明。
